<% layout('layout') -%>
<section class="section">
  <h2>Videos</h2>
  <div class="grid media-grid">
    <% videos.forEach(function(v){ %>
      <div class="card">
        <div class="card-media">
          <% const m = v.media && (v.media.find(x=>x.type==='file') || v.media.find(x=>x.type==='link')); %>
          <% if (m){ %>
            <% if (m.type==='file' && m.path.endsWith('.mp4')){ %>
              <video controls src="<%= m.path %>"></video>
            <% } else if (m.type==='link' && m.url.includes('youtube')){ %>
              <iframe src="<%= m.url.replace('watch?v=','embed/') %>" frameborder="0" allowfullscreen></iframe>
            <% } else if (m.type==='link' && m.url.endsWith('.mp4')){ %>
              <video controls src="<%= m.url %>"></video>
            <% } else if (m.type==='file'){ %>
              <video controls src="<%= m.path %>"></video>
            <% } else { %>
              <a class="link-btn" href="<%= m.url %>" target="_blank">Open Video</a>
            <% } %>
          <% } %>
        </div>
        <div class="card-body"><strong><%= v.title %></strong></div>
      </div>
    <% }) %>
  </div>
</section>

<section class="section">
  <h2>Photos</h2>
  <div class="grid media-grid">
    <% photos.forEach(function(p){ %>
      <div class="card">
        <div class="card-media">
          <% const m = p.media && (p.media.find(x=>x.type==='file') || p.media.find(x=>x.type==='link')); %>
          <% if (m){ %>
            <img src="<%= (m.type==='file'? m.path : m.url) %>" alt="<%= p.title %>" />
          <% } %>
        </div>
        <div class="card-body"><strong><%= p.title %></strong></div>
      </div>
    <% }) %>
  </div>
</section>

<section class="section">
  <h2>Blog Posts</h2>
  <div class="grid media-grid">
    <% posts.forEach(function(post){ %>
      <div class="card">
        <a class="card-link" href="/post/<%= post.id %>">
          <div class="card-media">
            <% const m = post.media && (post.media.find(x=>x.type==='file') || post.media.find(x=>x.type==='link')); %>
            <% if (m){ %>
              <img src="<%= (m.type==='file'? m.path : m.url) %>" alt="<%= post.title %>" />
            <% } %>
          </div>
          <div class="card-body"><strong><%= post.title %></strong></div>
        </a>
      </div>
    <% }) %>
  </div>
</section>
